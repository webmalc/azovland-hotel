{% extends "base.html" %} 
{% load wagtailimages_tags wagtailcore_tags static custom_tags humanize %}

{% block extra_css %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.8.3/css/lightgallery.min.css" integrity="sha512-QMCloGTsG2vNSnHcsxYTapI6pFQNnUP6yNizuLL5Wh3ha6AraI6HrJ3ABBaw6SIUHqlSTPQDs/SydiR98oTeaQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.8.3/css/lg-thumbnail.min.css" integrity="sha512-rKuOh3xlF/027KUPuMok0ESsZ2zWPRzkniD3n5zZKCAtbiVkYw66DR4KtVAGf8dLPLr5DdyQs05BlSmEyXctkQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}


{% block content %}
<section class="layout-pt-lg">
  <div data-anim-wrap class="container">
    <div class="row y-gap-30 justify-between items-end">
      <div class="col-auto">
        <h1 data-anim-child="slide-up delay-1" class="text-64 md:text-40">{{ page.title }}{{ room }}</h1>
        <div data-anim-child="slide-up delay-2" class="d-flex x-gap-50 md:x-gap-20 pt-20">

          <div class="d-flex items-center text-accent-1">
            <i class="icon-size text-20 mr-10"></i>
            {{ page.room_size }}
          </div>

          <div class="d-flex items-center text-accent-1">
            <i class="icon-guest text-20 mr-10"></i>
            {{ page.adults }}+{{ page.children }} 
          </div>

          <div class="d-flex items-center text-accent-1">
            <i class="icon-bed-2 text-20 mr-10"></i>
            {{ page.beds }}
          </div>
        </div>
      </div>

      <div class="col-auto">
        <a href="https://azovsky.ru/mbresults/?search_form%5Bhotel%5D=56fbd22174eb5383728b4567&search_form%5Bbegin%5D=24.04.2026&search_form%5Bend%5D=27.04.2026&search_form%5Badults%5D=1&search_form%5Bchildren%5D=0&search_form%5BshowSpecs%5D=false&search_form%5BshowSpecs%5D=1&submit=%D0%A3%D0%B7%D0%BD%D0%B0%D1%82%D1%8C+%D1%86%D0%B5%D0%BD%D1%8B">
          <div data-anim-child="slide-up delay-3" class="fw-500">РАСЧЕТ ЦЕНЫ</div>
        </a>
      </div>
    </div>

    <div data-anim-child="slide-up delay-4" class="row pt-50 md:pt-30">
      <div class="col-12">
        <div id="roomsPhotos" class="roomsSingleGrid -type-1">

          {% collection_images page.collection as photos %}
          {% for photo in photos|slice:"0:5" %}

            {% image photo width-1920 as full_img %}
            <a href="{{ full_img.url }}" class="baseCard -type-2">
              {% if forloop.counter == 1 %}
                {% image photo fill-840x570%}
              {% else %}
                {% image photo fill-270x280%}
              {% endif %}
            </a>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="row y-gap-40 justify-between pt-50">
      <div class="col-xl-7 col-lg-7">
        <h2 class="text-40">О номере</h2>
        <p class="mt-40">
          {{ page.introduction|linebreaksbr }}
        </p>

        <div class="line -horizontal bg-border mt-50 mb-50"></div>
        <h2 class="text-40">Комплекс услуг «Всё включено»</h2>
        <div class="row x-gap-50 y-gap-20 justify-between pt-40">
          <div class="col-sm-5">
            <div class="row y-gap-30">

              {% for block in page.features|second_half %}
                <div class="col-12">
                  <div class="d-flex items-center">
                    <i class="{{ block.value.icon }} room-icon text-30 mr-30"></i>
                    <div>{{ block.value.text|capfirst }}</div>
                  </div>
                </div>
              {% endfor %}

            </div>
          </div>

          <div class="col-sm-5">
            <div class="row y-gap-30">

              {% for block in page.features|first_half %}
                <div class="col-12">
                  <div class="d-flex items-center">
                    <i class="{{ block.value.icon }} room-icon text-30 mr-30"></i>
                    <div>{{ block.value.text|capfirst }}</div>
                  </div>
                </div>
              {% endfor %}

            </div>
          </div>
        </div>

        {% if page.body %}
          <div class="line -horizontal bg-border mt-50 mb-50"></div>
          {{ page.body }}
        {% endif %}
      </div>

      <div class="col-xl-4 col-lg-5">
        <div class="sidebar -rooms-single px-40 py-40 md:px-30 md:py-30 border-1 shadow-1">
          <h3 class="text-30 mb-30">Расчет цены</h3>

          <div class="row y-gap-30">
            <div class="col-12">

              <div class="searchForm -type-1 -dropdown-single">
                <div class="searchForm__form">
                  <div class="searchFormItem js-select-control js-form-dd js-calendar">
                    <div class="searchFormItem__button" data-x-click="calendar">
                      <div>
                        <span class="js-first-date">Заезд - выезд</span>
                        <span class="js-last-date"></span>
                      </div>
                      <i class="icon-chevron-down ml-40"></i>
                    </div>


                    <div class="searchFormItemDropdown -calendar" data-x="calendar" data-x-toggle="is-active">
                      <div class="searchFormItemDropdown__container">

                        <div class="searchMenu-date -searchForm js-form-dd js-calendar-el">
                          <div class="searchMenu-date__field shadow-2" data-x-dd="searchMenu-date" data-x-dd-toggle="-is-active">
                            <div class="rounded-4">
                              <div class="elCalendar js-calendar-el-calendar"></div>
                            </div>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <div class="col-12">

              <div class="searchForm -type-1 -dropdown-single">
                <div class="searchForm__form">
                  <div class="searchFormItem js-select-control js-form-dd">
                    <div class="searchFormItem__button" data-x-click="guests-2">
                      <div class="js-select-control-chosen">Взрослые</div>
                      <i class="icon-chevron-down ml-40"></i>
                    </div>
                    <div class="searchFormItemDropdown -counter" data-x="guests-2" data-x-toggle="is-active">
                      <div class="searchFormItemDropdown__container">
                        <div class="searchFormItemDropdown__list">

                          <div class="searchFormItemDropdown__item js-select-control-counter">
                            <div class="fw-500 js-search-title">Взрослые</div>
                            <div class="d-flex fw-500 js-search-counter">
                              <div class="cursor-pointer size-40 flex-center js-remove">
                                <i class="custom-icon-minus">
                                  <span></span>
                                </i>
                              </div>

                              <div class="size-40 flex-center js-number">1</div>

                              <div class="cursor-pointer size-40 flex-center js-add">
                                <i class="custom-icon-plus">
                                  <span></span>
                                  <span></span>
                                </i>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>

            </div>
            <div class="col-12">

              <div class="searchForm -type-1 -dropdown-single">
                <div class="searchForm__form">
                  <div class="searchFormItem js-select-control js-form-dd">
                    <div class="searchFormItem__button" data-x-click="guests-3">
                      <div class="js-select-control-chosen">Дети</div>
                      <i class="icon-chevron-down ml-40"></i>
                    </div>
                    <div class="searchFormItemDropdown -counter" data-x="guests-3" data-x-toggle="is-active">
                      <div class="searchFormItemDropdown__container">
                        <div class="searchFormItemDropdown__list">

                          <div class="searchFormItemDropdown__item js-select-control-counter">
                            <div class="fw-500 js-search-title">Дети</div>
                            <div class="d-flex fw-500 js-search-counter">
                              <div class="cursor-pointer size-40 flex-center js-remove">
                                <i class="custom-icon-minus">
                                  <span></span>
                                </i>
                              </div>

                              <div class="size-40 flex-center js-number">0</div>

                              <div class="cursor-pointer size-40 flex-center js-add">
                                <i class="custom-icon-plus">
                                  <span></span>
                                  <span></span>
                                </i>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>

            </div>
          </div>
          <button id="get-price-btn" class="button -md bg-accent-2 -dark-1 w-1/1 mt-40">Узнать цены</button>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="layout-pt-lg layout-pb-lg">
  <div data-anim-wrap class="container">
    <div class="row y-gap-30 justify-between items-end">
      <div data-anim-child="slide-up delay-1" class="col-auto">
        <div class="text-15 uppercase mb-30 sm:mb-10">Посмотреть еще</div>
        <h2 class="text-64 md:text-40 lh-065">Другие номера</h2>
      </div>

      <div data-anim-child="slide-up delay-1" class="col-auto">
        <button class="button -type-1" onclick="location.href='{% slugurl 'rooms' %}'">
          <i class="-icon icon-arrow-circle-right text-30"></i>
          Посмотреть все
        </button>
      </div>
    </div>

    <div class="relative mt-100 sm:mt-50">
      <div class="overflow-hidden js-section-slider" data-gap="30" data-slider-cols="xl-3 lg-3 md-2 sm-1 base-1" data-nav-prev="js-slider2-prev" data-nav-next="js-slider2-next">
        <div class="swiper-wrapper">

          {% for room in page.similar_rooms %}
          <div class="swiper-slide">
            <div data-anim-child="slide-up delay-4">
              <a href="{% pageurl room %}" class="roomCard -type-2 -hover-button-center">
                <div class="roomCard__image -no-rounded ratio ratio-45:54 -hover-button-center__wrap">
                  {% image room.image fill-440x550 class="img-ratio" %}

                  <div class="-hover-button-center__button flex-center size-130 rounded-full bg-accent-1-50 blur-1 border-white-10">
                    <span class="text-15 fw-500 text-white">ПОДРОБНЕЕ</span>
                  </div>
                </div>

                <div class="roomCard__content mt-30">
                  <div class="d-flex justify-between items-end">
                    <h3 class="roomCard__title lh-065 text-40 md:text-24">{{ room.title }}</h3>
                  </div>

                  <div class="d-flex x-gap-30 pt-30">

                    <div class="d-flex items-center text-accent-1">
                      <i class="icon-size text-20 mr-10"></i>
                      {{ room.size }}
                    </div>

                    <div class="d-flex items-center text-accent-1">
                      <i class="icon-guest text-20 mr-10"></i>
                      {{ room.adults }}+{{room.children}}
                    </div>

                    <div class="d-flex items-center text-accent-1">
                      <i class="icon-bed-2 text-20 mr-10"></i>
                      {{ room.beds }}
                    </div>
                  </div>
                </div>
              </a>
            </div>
          </div>
          {% endfor %}

        </div>
      </div>

      <div class="navAbsolute -type-2">
        <button class="button -outline-accent-1 size-80 md:size-60 flex-center rounded-full js-slider2-prev">
          <i class="icon-arrow-left text-24"></i>
        </button>

        <button class="button -outline-accent-1 size-80 md:size-60 flex-center rounded-full js-slider2-next">
          <i class="icon-arrow-right text-24"></i>
        </button>
      </div>
    </div>
  </div>
</section>
{% endblock content %}

{% block extra_js %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.8.3/lightgallery.min.js" integrity="sha512-n02TbYimj64qb98ed5WwkNiSw/i9Xlvv4Ehvhg0jLp3qMAMWCYUHbOMbppZ0vimtyiyw9NqNqxUZC4hq86f4aQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.8.3/plugins/thumbnail/lg-thumbnail.min.js" integrity="sha512-jZxB8WysJ6S6e4Hz5IZpAzR1WiflBl0hBxriHGlLkUN32T18+rD1aLNifa1KTll/zx8lIfWVP1NqEjHi/Khy5w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const galleryContainer = document.getElementById('roomsPhotos')
    if (galleryContainer) {
      lightGallery(galleryContainer, {
          thumbnail: true,
      });
    }

    document.getElementById('get-price-btn').addEventListener('click', function() {
        const calendar = document.querySelector('.js-calendar-el-calendar');
        const firstDateEl = document.querySelector('.js-first-date');
        
        let checkIn = '24.04.2026';
        let checkOut = '27.04.2026';
        
        if (calendar && firstDateEl && firstDateEl.textContent.trim() !== 'Заезд - выезд') {
            const activeItems = calendar.querySelectorAll('.-is-active');
            
            if (activeItems.length >= 2) {
                const firstItem = activeItems[0];
                const lastItem = activeItems[activeItems.length - 1];
                
                const getFullDate = (item) => {
                    const day = parseInt(item.querySelector('.js-date').textContent.trim());
                    const monthStr = item.getAttribute('data-month');
                    
                    const monthMap = {'янв': 0, 'фев': 1, 'мар': 2, 'апр': 3, 'май': 4, 'июн': 5, 'июл': 6, 'авг': 7, 'сен': 8, 'окт': 9, 'ноя': 10, 'дек': 11};
                    const month = monthMap[monthStr];
                    
                    const slides = calendar.querySelectorAll('.elCalendar__month');
                    let year = 2026;
                    
                    slides.forEach((slide, slideIndex) => {
                        if (slide.contains(item)) {
                            const slideMonthIndex = slideIndex;
                            year = 4 + slideMonthIndex > 12 ? 2027 : 2026;
                        }
                    });
                    
                    return ('0' + day).slice(-2) + '.' + ('0' + (month + 1)).slice(-2) + '.' + year;
                };
                
                checkIn = getFullDate(firstItem);
                checkOut = getFullDate(lastItem);
            }
        }
        
        const adultsDropdown = document.querySelector('[data-x="guests-2"]');
        const adultsCount = adultsDropdown ? adultsDropdown.querySelector('.js-number').textContent.trim() : '1';
        
        const childrenDropdown = document.querySelector('[data-x="guests-3"]');
        const childrenCount = childrenDropdown ? childrenDropdown.querySelector('.js-number').textContent.trim() : '0';
        
        let childrenAgeParams = '';
        if (childrenCount > 0) {
            for (let i = 1; i <= parseInt(childrenCount); i++) {
                childrenAgeParams += '&search_form%5Bchildren_age%5D%5B' + i + '%5D=12';
            }
        }
        
        const url = 'https://azovsky.ru/mbresults/?search_form%5Bhotel%5D=56fbd22174eb5383728b4567&search_form%5Bbegin%5D=' + checkIn + '&search_form%5Bend%5D=' + checkOut + '&search_form%5Badults%5D=' + adultsCount + '&search_form%5Bchildren%5D=' + childrenCount + childrenAgeParams + '&search_form%5BshowSpecs%5D=false&search_form%5BshowSpecs%5D=1&submit=%D0%A3%D0%B7%D0%BD%D0%B0%D1%82%D1%8C+%D1%86%D0%B5%D0%BD%D1%8B';
        window.location.href = url;
    });
});
</script>
{% endblock %}
